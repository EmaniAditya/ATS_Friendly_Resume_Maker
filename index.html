<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ATS Friendly Resume Maker</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <style>
    body {
      background-color: #f8f9fa;
      padding: 20px;
    }

    #resumePreview {
      background: white;
      width: 210mm;
      min-height: 297mm;
      max-height: 297mm; /* Limit to A4 height */
      padding: 20mm;
      margin: auto;
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
      font-family: Arial, sans-serif;
      overflow: hidden; /* Hide overflow content */
      position: relative;
    }

    .page-warning {
      display: none;
      color: #dc3545;
      font-weight: bold;
      margin-top: 10px;
      text-align: center;
    }

    /* Compact mode styles */
    .compact-mode #resumePreview {
      font-size: 11px;
      line-height: 1.2;
      padding: 15mm;
    }

    .compact-mode #resumePreview h2 {
      font-size: 18px;
      margin-bottom: 5px;
    }

    .compact-mode #resumePreview h4 {
      font-size: 13px;
      margin-top: 10px;
      margin-bottom: 5px;
    }

    .compact-mode #resumePreview p {
      margin-bottom: 5px;
    }

    .compact-mode #resumePreview ul {
      margin-top: 5px;
      margin-bottom: 5px;
      padding-left: 20px;
    }

    .compact-mode #resumePreview li {
      margin-bottom: 2px;
    }

    .compact-mode .experience-entry,
    .compact-mode .education-entry,
    .compact-mode .project-entry {
      margin-bottom: 5px;
    }

    /* Extreme compact mode for very long content */
    .extreme-compact-mode #resumePreview {
      font-size: 10px;
      line-height: 1.1;
      padding: 12mm;
    }
    
    .extreme-compact-mode #resumePreview h2 {
      font-size: 16px;
      margin-bottom: 3px;
    }
    
    .extreme-compact-mode #resumePreview h4 {
      font-size: 12px;
      margin-top: 8px;
      margin-bottom: 3px;
    }
    
    .extreme-compact-mode #resumePreview p,
    .extreme-compact-mode #resumePreview ul,
    .extreme-compact-mode #resumePreview li {
      margin-bottom: 2px;
    }
    
    .extreme-compact-mode .experience-entry,
    .extreme-compact-mode .education-entry,
    .extreme-compact-mode .project-entry {
      margin-bottom: 3px;
    }

    /* Toggle switch for compact mode */
    .form-check-label {
      user-select: none;
    }

    .template-classic h2 {
      font-weight: bold;
      font-size: 28px;
      text-align: center;
      margin-bottom: 10px;
    }

    .template-classic h4 {
      margin-top: 15px;
      border-bottom: 1px solid #333;
      padding-bottom: 4px;
      font-weight: bold;
    }

    .template-modern h2 {
      font-weight: bold;
      font-size: 28px;
      margin-bottom: 10px;
    }

    .template-modern h4 {
      margin-top: 15px;
      color: #2a5885;
      font-weight: bold;
      border-bottom: 2px solid #2a5885;
      padding-bottom: 4px;
    }

    .template-minimalist h2 {
      font-weight: bold;
      font-size: 28px;
      margin-bottom: 10px;
    }

    .template-minimalist h4 {
      margin-top: 15px;
      font-weight: bold;
      text-transform: uppercase;
      letter-spacing: 1px;
      font-size: 14px;
    }

    .template-professional h2 {
      font-weight: bold;
      font-size: 28px;
      margin-bottom: 10px;
    }

    .template-professional h4 {
      margin-top: 15px;
      font-weight: bold;
      background-color: #f8f9fa;
      padding: 5px;
    }

    .form-label {
      font-weight: bold;
    }

    .contact-info {
      margin-bottom: 15px;
    }

    .skill-item {
      display: inline-block;
      margin-right: 10px;
      margin-bottom: 5px;
    }

    .experience-item, .education-item, .project-item {
      margin-bottom: 15px;
    }

    .btn-add {
      margin-top: 5px;
    }

    .form-section {
      background-color: white;
      padding: 20px;
      border-radius: 8px;
      margin-bottom: 20px;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.05);
    }

    .section-title {
      border-bottom: 1px solid #eee;
      padding-bottom: 10px;
      margin-bottom: 15px;
    }

    .ats-tip {
      font-size: 12px;
      color: #6c757d;
      margin-top: 5px;
    }
    
    .rated-skills {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-bottom: 10px;
    }
    
    .rated-skill {
      background-color: #f8f9fa;
      padding: 3px 8px;
      border-radius: 4px;
      font-size: 0.9em;
    }
    
    .rated-skill .skill-name {
      font-weight: bold;
    }
    
    /* Section order styling */
    #sectionOrder {
      cursor: move;
    }
    
    #sectionOrder li {
      cursor: grab;
      user-select: none;
    }
    
    #sectionOrder li:active {
      cursor: grabbing;
    }
    
    /* Toast styling */
    .toast {
      min-width: 250px;
    }
    
    /* Loading spinner */
    .loading-spinner {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(255, 255, 255, 0.7);
      z-index: 9999;
      justify-content: center;
      align-items: center;
    }
    
    /* Sticky preview on scroll for desktop */
    @media (min-width: 992px) {
      .sticky-preview {
        position: sticky;
        top: 20px;
      }
    }

    @media (max-width: 768px) {
      #resumePreview {
        width: 100%;
        padding: 15px;
        font-size: 14px;
        min-height: auto;
        max-height: none;
      }

      .container {
        padding: 10px;
      }

      h1 {
        font-size: 24px;
      }

      .form-label {
        font-size: 14px;
      }
      
      .form-section {
        padding: 15px;
      }
      
      /* Collapsible sections for mobile */
      .mobile-collapsible .section-title {
        cursor: pointer;
        position: relative;
      }
      
      .mobile-collapsible .section-title:after {
        content: "\25BC";
        position: absolute;
        right: 0;
        transition: transform 0.3s;
      }
      
      .mobile-collapsible.collapsed .section-title:after {
        transform: rotate(-90deg);
      }
      
      .mobile-collapsible.collapsed .section-content {
        display: none;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1 class="text-center mb-4">ATS Friendly Resume Maker</h1>
    
    <!-- Loading Spinner -->
    <div class="loading-spinner" id="loadingSpinner">
      <div class="spinner-border text-primary" role="status">
        <span class="visually-hidden">Loading...</span>
      </div>
    </div>
    
    <div class="row">
      <div class="col-lg-6">
        <!-- Form Sections -->
        <div class="form-section mobile-collapsible">
          <h3 class="section-title" onclick="toggleMobileSection(this)">Personal Information</h3>
          <div class="section-content">
            <!-- Personal Info content -->
          </div>
        </div>
        
        <!-- Other form sections with mobile-collapsible class -->
        <!-- ... existing code ... -->
      </div>
      
      <div class="col-lg-6">
        <div class="sticky-preview">
          <div id="resumePreview" class="mt-3"></div>
          
          <div class="mt-3 d-flex justify-content-center">
            <div class="btn-group">
              <button type="button" class="btn btn-sm btn-outline-secondary" onclick="applyDensitySetting(1)">Low Density</button>
              <button type="button" class="btn btn-sm btn-outline-secondary active" onclick="applyDensitySetting(2)">Normal</button>
              <button type="button" class="btn btn-sm btn-outline-secondary" onclick="applyDensitySetting(3)">High Density</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <!-- ... existing modals ... -->
  
  <script>
    // ... existing code ...
    
    // Toggle mobile section collapse
    function toggleMobileSection(titleElement) {
      if (window.innerWidth <= 768) {
        const section = titleElement.closest('.mobile-collapsible');
        section.classList.toggle('collapsed');
      }
    }
    
    // Show loading spinner
    function showLoading() {
      document.getElementById('loadingSpinner').style.display = 'flex';
    }
    
    // Hide loading spinner
    function hideLoading() {
      document.getElementById('loadingSpinner').style.display = 'none';
    }
    
    // Apply density setting with visual feedback
    function applyDensitySetting(densityValue) {
      // Update the slider if it exists
      const densitySlider = document.getElementById("densitySlider");
      if (densitySlider) {
        densitySlider.value = densityValue;
      }
      
      // Remove existing classes
      document.body.classList.remove('compact-mode');
      document.body.classList.remove('extreme-compact-mode');
      
      // Update active button state
      const densityButtons = document.querySelectorAll('.btn-group .btn');
      densityButtons.forEach((btn, index) => {
        btn.classList.remove('active');
        if (index === densityValue - 1) {
          btn.classList.add('active');
        }
      });
      
      // Apply appropriate class based on density setting
      if (densityValue === 2) {
        document.body.classList.add('compact-mode');
      } else if (densityValue === 3) {
        document.body.classList.add('extreme-compact-mode');
      }
      
      // Save current data with the new density setting
      saveCurrentData();
      
      // Check if content fits on one page
      setTimeout(checkPageOverflow, 100);
    }
    
    // Modified functions to handle loading state
    function downloadPDF() {
      showLoading();
      
      const element = document.getElementById("resumePreview");
      const opt = {
        margin: 0,
        filename: 'ATS_Friendly_Resume.pdf',
        image: { type: 'jpeg', quality: 0.98 },
        html2canvas: { scale: 2 },
        jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
      };
      
      // Check if preview is empty
      if (element.innerHTML.trim() === '') {
        hideLoading();
        alert('Please preview your resume before downloading');
        return;
      }
      
      // Apply current density setting
      applyDensitySetting(parseInt(document.getElementById("densitySlider")?.value || 2));
      
      // Save a version when downloading PDF
      const versionName = `Resume - ${new Date().toLocaleString()}`;
      saveVersion(versionName);
      
      html2pdf().set(opt).from(element).save().then(() => {
        hideLoading();
        showToast('Resume version saved! You can access it later from "Manage Versions".');
      }).catch(error => {
        hideLoading();
        showToast('Error generating PDF: ' + error.message, 'error');
      });
    }
    
    // Initialize with saved data or preview
    window.addEventListener('DOMContentLoaded', function() {
      // Initialize mobile sections
      if (window.innerWidth <= 768) {
        const sections = document.querySelectorAll('.mobile-collapsible');
        sections.forEach((section, index) => {
          // Keep first section expanded, collapse others
          if (index > 0) {
            section.classList.add('collapsed');
          }
        });
      }
      
      // ... existing initialization code ...
    });
    
    // ... existing code ...
  </script>
  
  <!-- ... existing code ... -->
</body>
// ... existing code ...
